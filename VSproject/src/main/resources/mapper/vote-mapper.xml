<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org // DTD mapper 3.0 // en" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mapper.vote-mapper">


	<select id="allVote" resultType="vote">
		SELECT *
		FROM VOTE
		WHERE b_seq = #{b_seq}
	</select>
	
	<insert id="FirstVote">
		<selectKey resultType="Integer" keyProperty="b_seq"  order="BEFORE">
			SELECT MAX(b_seq)
			FROM board
		</selectKey>
		INSERT INTO VOTE
		VALUES(Vote_sequence1.NEXTVAL,#{b_seq},#{u_id},0,sysdate,#{v_ip})
	</insert>
	
	<insert id="Vote">
		INSERT INTO VOTE
		VALUES(Vote_sequence1.NEXTVAL,#{b_seq},#{u_id},#{v_like},sysdate,#{v_ip})
	</insert>
	
	<select id="LeftCnt" resultType="Integer">
		SELECT count(*)
		FROM VOTE
		WHERE b_seq=#{b_seq} and v_like=1
	</select>
	
	<select id="RightCnt" resultType="Integer">
		SELECT count(*)
		FROM VOTE
		WHERE b_seq=#{b_seq} and v_like=2
	</select>
	
	<select id="UserVote" resultType="vote">
		SELECT *
		FROM VOTE v
		LEFT OUTER JOIN board b on b.b_seq = v.b_seq 
		WHERE v.u_id = #{u_id}
	</select>
	
	<select id="VoteConfirm" resultType="Vote">
		SELECT *
		FROM VOTE V		
		WHERE b_seq=#{b_seq} and u_id=#{u_id}		
		
	</select>
	
	<select id="VoteConfirm2" resultType="Vote">
		SELECT *
		FROM VOTE
		WHERE b_seq=#{b_seq} and v_ip=#{v_ip}
	</select>
	
</mapper>
